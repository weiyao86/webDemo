(function(n){function t(t){var u=function(){return{maxZoom:3,minZoom:.5,radius:15,dock:"TC",imgError:!1,assistiveTool:"1",tbodyId:"tbody",renderToId:"legend-render",nopic:"",selectedRowBgClass:"row-active",legendExist:!1,isShowAssistiveTool:!0,loading:!0,swfLegendWidth:0,swfLegendHeight:0,legendLoadingImg:"",grabSrc:"",grabbingSrc:"",circleLineColor:{seekColor:"#FFDD00",checkedColor:"#FF1020"},callbacks:{onPrint:null,onToolClick:null,onBindPartList:null,onLegendDbClick:null,onLegendBeforeLoad:null,onLegendAfterLoad:null,onSelectionPartError:null}}}(),r;return function(){var n=document.createElement("link"),t=require.s.contexts._.config.baseUrl+i+"css/hotpoint.css";n.type="text/css";n.rel="stylesheet";n.href=t;document.getElementsByTagName("head")[0].appendChild(n)}(),r=function(t){this.opts=n.extend(!0,{},u,t||{});this.LEGEND_ID="legend";this.LEGEND_IMG_ID="legend-img";this.LEGEND_WRAP_ID="legend-wrap";this.percent=1;this.dictList={};this.isDone=!0;this.curCoords=[];this.curCallouts=[];this.dragLegendPosition={};this.radius=this.opts.radius;this.data=this.opts.data||[];this.dragAssisactiveToolPosition={};this.legendLoadingImg=this.opts.legendLoadingImg||"";this.grabSrc=this.opts.grabSrc||"";this.grabbingSrc=this.opts.grabbingSrc||"";this.init()},r.prototype=function(){return{init:function(){var n=this;n.buildDomEl();n.initGraphics();n.bindResize();n.bindEvent();n.buildAssistiveTool()},buildDomEl:function(){var t=this,i=t.getLegendHTML();t.$renderTo=n("#"+t.opts.renderToId);t.$renderTo.append(i);t.$tbody=n("#"+t.opts.tbodyId);t.$legend=n("#"+t.LEGEND_ID);t.$legendWrap=n("#"+t.LEGEND_WRAP_ID)},getLegendHTML:function(){var t=this,n=[];return n.push('<div id="'+t.LEGEND_WRAP_ID+'" class="legend-wrap">'),n.push('<div id="'+t.LEGEND_ID+'" class="legend">'),n.push("<\/div>"),n.push("<\/div>"),n.join(" ")},initGraphics:function(){var n=this;n.graphics=new jsGraphics(n.$legend.get(0))},bindLegend:function(n,t){var i=this;i.destroyLegend();i.data=n.data;i.swfLegendWidth=n.swfLegendWidth;i.swfLegendHeight=n.swfLegendHeight;i.setLegendSrc(n.src,t)},destroyLegend:function(){var n=this;n.data=null;n.dictList=null;n.buildData=[];n.curCoords=[];n.opts.legendExist=!1;n.resetLegend();n.clearHotpoint();n.$legend.html("")},setLegendSrc:function(t,i){var r=this,u=new Image,e=r.opts.callbacks.onLegendBeforeLoad,f=r.opts.callbacks.onLegendAfterLoad;typeof e=="function"&&e.apply(r,[]);r.opts.loading&&r.loadingShow();n(u).on("load",function(){typeof f=="function"&&f.apply(r,[u]);r.finishImgLoad(u,i)}).on("error",function(){typeof f=="function"&&f.apply(r,[u]);r.loadErrorImg()}).attr("src",t)},finishImgLoad:function(n,t){var i=this;i.opts.legendExist=!0;i.legendRawSize={width:n.width,height:n.height};i.settingSize();i.$legend.html(n);i.buildCoord(i.data);!i.existAssistiveTool;typeof t=="function"&&t.apply(i,[]);i.opts.loading&&i.loadingHide();i.disabledAccistiveTool()},loadErrorImg:function(){var n=this,t=n.opts.nopic;n.opts.legendExist=!1;n.legendRawSize={width:0,height:0};n.$legend.empty().css("background","url("+t+") no-repeat center center");n.disabledAccistiveTool();n.opts.loading&&n.loadingHide()},settingSize:function(){var n=this,i=n.$legendWrap.parent().width(),r=n.$legendWrap.parent().height(),t=n.opts.legendExist?n.scalingDownCalc(n.legendRawSize.width,n.legendRawSize.height,i,r):{top:0,left:0,width:i,height:r};n.$legend.css({top:t.top+"px",left:t.left+"px",width:t.width,height:t.height});n.$legendWrap.css({width:i,height:r});n.legendWidth=n.$legend.width();n.legendHeight=n.$legend.height();n.legendOffsetTop=n.$legend.offset().top;n.legendOffsetLeft=n.$legend.offset().left;n.x1=n.$legendWrap.offset().left;n.y1=n.$legendWrap.offset().top;n.x2=n.$legendWrap.offset().left+n.$legendWrap.width();n.y2=n.$legendWrap.offset().top+n.$legendWrap.height()},buildCoord:function(n){var t=this,f=t.radius,s,h=0,e=0,o=0,i,r=0,u=0,c=0,l=0,a=0,v=0,y,p=t.swfLegendWidth/t.legendWidth,w=t.swfLegendHeight/t.legendHeight;for(t.dictList={},t.buildData=[];i=n[h];h++)if(i.x&&i.y)for(s=i.callout,r=parseInt(i.x/p),u=parseInt(i.y/w),t.buildData.push({x:r,y:u,callout:s}),c=r-f,l=r+f,a=u-f,v=u+f,e=c;e<l;e++)for(o=a;o<v;o++)y=e+"-"+o,t.dictList[y]={x:r,y:u}},bindResize:function(){var t=this;n(window).resize(function(){t.legendRawSize&&t.resizeToAdjust()})},resizeToAdjust:function(){var n=this;n.resetLegend();n.settingSize();n.buildCoord(n.data||[]);n.redraw();n.assistiveToolDock();n.linkHotpoint(n.curCallouts)},bindEvent:function(){var t=this;t.$legend.on({click:function(n){t.opts.legendExist&&t.clickLegend(n,this);n.preventDefault()},dblclick:function(n){typeof t.opts.callbacks.onLegendDbClick=="function"?t.opts.callbacks.onLegendDbClick.apply(t,[]):t.opts.legendExist&&t.zoomLegend(1,n);n.preventDefault()},mousemove:function(n){t.opts.legendExist&&t.seekHotpoint(n,this);n.preventDefault()},mousedown:function(n){t.percent>1&&t.opts.legendExist&&t.startDragLegend(n,this);n.preventDefault()},mousewheel:function(n,i){t.opts.legendExist&&t.zoomLegend(i,n);n.preventDefault()}});t.$legend.on("mouseenter","img",function(){n(this).css("cursor",'url("'+t.grabSrc+'"),pointer')});if(t.opts.callbacks.onBindPartList===null)t.$tbody.on("click","tr[data-callout]",function(){t.opts.legendExist&&t.rowsClick(this)})},buildAssistiveTool:function(){var t=this,i=t.getAssistiveToolTemplate();t.$assistiveTool=n(i);t.$legendWrap.append(t.$assistiveTool);t.bindAssistiveToolEvent();t.assistiveToolDock();t.$assistiveTool.show();t.existAssistiveTool=!0},disabledAccistiveTool:function(){var n=this,t=n.$assistiveTool.find("[data-action=zoomout]"),i=n.$assistiveTool.find("[data-action=zoomin]"),r=n.$assistiveTool.find("[data-action=reset]");n.opts.legendExist?(t.removeClass("assistive-tool-zoomout-disabled").addClass("assistive-tool-zoomout"),i.removeClass("assistive-tool-zoomin-disabled").addClass("assistive-tool-zoomin"),r.removeClass("assistive-tool-reset-disabled").addClass("assistive-tool-reset")):(t.removeClass("assistive-tool-zoomout").addClass("assistive-tool-zoomout-disabled"),i.removeClass("assistive-tool-zoomin").addClass("assistive-tool-zoomin-disabled"),r.removeClass("assistive-tool-reset").addClass("assistive-tool-reset-disabled"))},bindAssistiveToolEvent:function(){var t=this,i;t.$assistiveTool.on("mousedown",function(n){t.startDragAssistiveTool(n,this)});t.$assistiveTool.on("click","a:not([class*='disabled'])",function(){i=n(this).attr("data-action");switch(i){case"zoomin":t.zoomIn();break;case"zoomout":t.zoomOut();break;case"up":t.moveUp();break;case"right":t.moveRight();break;case"down":t.moveDown();break;case"left":t.moveLeft();break;case"reset":t.resetLegend();t.redraw();break;case"print":t.opts.callbacks.onPrint&&t.opts.callbacks.onPrint.apply(null,[]);break;default:t.opts.callbacks.onToolClick&&t.opts.callbacks.onToolClick.apply(null,[i])}})},assistiveToolDock:function(){if(this.opts.legendExist){var n=this,u=n.opts.dock,i=n.$legendWrap.height()-n.$assistiveTool.height()-5,t=n.$legendWrap.width()-n.$assistiveTool.width()-5,r=t/2;switch(u){case"TL":n.$assistiveTool.css({left:"5px",top:"5px"});break;case"TC":n.$assistiveTool.css({left:r+"px",top:"5px"});break;case"TR":n.$assistiveTool.css({left:t+"px",top:"5px"});break;case"BL":n.$assistiveTool.css({left:"5px",top:i+"px"});break;case"BC":n.$assistiveTool.css({left:r+"px",top:i+"px"});break;case"BR":n.$assistiveTool.css({left:t+"px",bottom:"0px"})}}},startDragAssistiveTool:function(t,i){var r=this,u={},f=r.getSizeAndPosition(r.$legendWrap),e=r.getSizeAndPosition(r.$assistiveTool);r.dragAssisactiveToolPosition.top=t.pageY-f.offsetTop-e.top;r.dragAssisactiveToolPosition.left=t.pageX-f.offsetLeft-e.left;n(document).bind({"mousemove.hotpoint":function(n){u=r.movingRange(n,i,r.dragAssisactiveToolPosition);r.dragMove(i,u);n.preventDefault()},"mouseup.hotpoint":function(){n(this).unbind("mousemove.hotpoint mouseup.hotpoint");t.preventDefault()}})},rowsClick:function(t){var i=this,r=n(t).attr("data-callout");i.linkHotpoint([r])},seekHotpoint:function(n,t){var i=this,f="",e=i.getPosition(n,t),o=i.opts.circleLineColor.seekColor,r=i.getCoord(e.left,e.top),u=i.$legend.find("div[id^='t-']").attr("id");if(typeof r!="undefined"){if(f="t-"+r.x+"-"+r.y,u===f)return;typeof u!="undefined"&&i.clearHotpoint(u);i.checkCoordExist(r)&&i.drawHotpoint(f,r,o)}else typeof u!="undefined"&&i.clearHotpoint(u)},checkCoordExist:function(n){for(var r=this,i=0,t;t=r.curCoords[i];i++)if(t.x==n.x&&t.y==n.y)return!1;return!0},clickLegend:function(n,t){var i=this,f,r=[],u,o=i.getPosition(n,t),e=i.getCoord(o.left,o.top),s=i.opts.callbacks.onSelectionCallout;typeof e!="undefined"&&(f=i.getCallout(e.x,e.y),typeof f!="undefined"&&(r.push(f),u=i.getCalloutCoord(r),u.length>0&&(i.clearHotpoint(),i.activateHotpoint(u,r),typeof s=="function"&&s.apply(i,[r])),i.curCoords=u),i.curCallouts=r)},startDragLegend:function(t,i){var r=this,u={},f=r.getSizeAndPosition(r.$legend),e=r.getSizeAndPosition(r.$legendWrap);r.dragLegendPosition.top=t.pageY-e.offsetTop-f.top;r.dragLegendPosition.left=t.pageX-e.offsetLeft-f.left;r.$legend.find("img").css("cursor",'url("'+r.grabbingSrc+'"),pointer');n(document).bind({"mousemove.hotpoint":function(n){u=r.getMovePosition(n,r.dragLegendPosition);r.dragMove(i,u);n.preventDefault()},"mouseup.hotpoint":function(){n(this).unbind("mousemove.hotpoint mouseup.hotpoint");r.$legend.find("img").css("cursor",'url("'+r.grabSrc+'"),pointer');t.preventDefault()}})},getCallout:function(n,t){for(var u=this,r=0,i={},f;r<u.buildData.length;r++)if(i=u.buildData[r],i.x===n&&i.y===t){f=i.callout;break}return f},getCoord:function(n,t){var i=this,r=n+"-"+t;return i.dictList[r]},drawHotpoint:function(t,i,r){if(this.opts.legendExist){var u=this,f=u.percent,e=i.x*f,o=i.y*f,s=u.radius*f,h=new jsColor(r),c=new jsPen(h,3),l=new jsPoint(e,o),a=u.graphics.drawCircle(c,l,s);n(a).attr({id:t,"data-type":"hotpoint"})}},activateHotpoint:function(n){for(var i=this,t=0,r,u=i.opts.circleLineColor.checkedColor;t<n.length;t++)r=n[t].x+"-"+n[t].y,i.drawHotpoint(r,n[t],u)},linkHotpoint:function(n){var t=this;t.clearHotpoint();t.curCallouts=n;t.curCoords=t.getCalloutCoord(n);t.curCoords.length===1?(t.legendToCenter(t.curCoords[0].x,t.curCoords[0].y),t.activateHotpoint(t.curCoords,n)):(t.resetLegend(),t.redraw())},clearHotpoint:function(n){var t=this;n?t.$legend.find("#"+n).remove():t.$legend.find("div[data-type='hotpoint']").remove()},movingRange:function(t,i,r){var f=this,e=5,o=5,u=f.getMovePosition(t,r),s=f.$legendWrap.width()-n(i).width()-5,h=f.$legendWrap.height()-n(i).height()-5;return u.left<e&&(u.left=e),u.top<o&&(u.top=o),u.left>s&&(u.left=s),u.top>h&&(u.top=h),u},dragMove:function(t,i){var r=this;n(t).css({left:i.left+"px",top:i.top+"px"})},getMovePosition:function(n,t){var i=this,r=i.getSizeAndPosition(i.$legendWrap),u=n.pageY-r.offsetTop-t.top,f=n.pageX-r.offsetLeft-t.left;return{top:u,left:f}},zoomLegend:function(n,t){var i=this,e=1,s,o=1.2,f=0,r=0,u=i.getSizeAndPosition(i.$legend),h=i.getSizeAndPosition(i.$legendWrap);(n>0?(r=u.width*o,f=u.height*o):(r=u.width/o,f=u.height/o),e=r/i.legendWidth,e>=i.opts.maxZoom||e<=i.opts.minZoom)||(i.percent=e,i.$legend.width(r).height(f),s=typeof t=="undefined"?{top:(h.height-f)/2,left:(h.width-r)/2}:i.getZoomPosition(t,u.width,u.height,r,f),i.$legend.css({left:s.left+"px",top:s.top+"px"}),i.redraw())},getZoomPosition:function(n,t,i,r,u){var f=this,e=f.getCursorPosition(n),o=f.getSizeAndPosition(f.$legendWrap),s=n.pageX-o.offsetLeft,h=n.pageY-o.offsetTop,c=(e.top/i).toFixed(2),l=(e.left/t).toFixed(2);return{top:h-u*c,left:s-r*l}},getCursorPosition:function(n){var t=this,i=t.getSizeAndPosition(t.$legendWrap),r=t.getSizeAndPosition(t.$legend);return{top:n.pageY-i.offsetTop-r.top,left:n.pageX-i.offsetLeft-r.left}},getPosition:function(n){var t=this,i=t.getSizeAndPosition(t.$legend),e=t.getSizeAndPosition(t.$legendWrap),r=t.getLegendMarge(),u=parseInt((n.pageY-t.legendOffsetTop-i.top+r.margeTop)/t.percent),f=parseInt((n.pageX-t.legendOffsetLeft-i.left+r.margeLeft)/t.percent);return{top:u,left:f}},getLegendMarge:function(){var n=this,t=(n.$legendWrap.width()-n.legendWidth)/2,i=(n.$legendWrap.height()-n.legendHeight)/2;return{margeLeft:t,margeTop:i}},legendToCenter:function(n,t){var i=this,u=i.percent,r=i.getSizeAndPosition(i.$legend),f=i.getSizeAndPosition(i.$legendWrap),s=i.x1,h=i.y1,c=i.x2,l=i.y2,e=f.offsetTop+t*u+r.top-15,o=f.offsetLeft+n*u+r.left-15,a=f.height/2-t*u-15,v=f.width/2-n*u-15;o>s&&e>h&&o<c&&e<l||(r.cssTop!==0||r.cssLeft!==0||r.width!==i.legendWidth||r.height!==i.legendHeight)&&i.$legend.css({left:v+"px",top:a+"px"})},getSizeAndPosition:function(n){return{width:n.width(),height:n.height(),top:n.position().top,left:n.position().left,offsetTop:n.offset().top,offsetLeft:n.offset().left}},getCalloutCoord:function(t){for(var e=this,u,f=[],i=0,r=e.buildData;i<r.length;i++)u=r[i].callout.toString(),n.inArray(u,t)>-1&&f.push({x:r[i].x,y:r[i].y});return f},zoomIn:function(n){var t=this;t.zoomLegend(1,n)},zoomOut:function(n){var t=this;t.zoomLegend(0,n)},resetLegend:function(){var n=this,t=(n.$legendWrap.height()-n.legendHeight)/2,i=(n.$legendWrap.width()-n.legendWidth)/2;n.percent=1;n.$legend.css({top:t+"px",left:i+"px",width:n.legendWidth,height:n.legendHeight})},moveUp:function(){var n=this;n.isDone&&n.percent>1&&(n.isDone=!1,n.$legend.animate({top:"+=100px"},"slow",function(){n.isDone=!0}))},moveLeft:function(){var n=this;n.isDone&&n.percent>1&&(n.isDone=!1,n.$legend.animate({left:"+=100px"},"slow",function(){n.isDone=!0}))},moveRight:function(){var n=this;n.isDone&&n.percent>1&&(n.isDone=!1,n.$legend.animate({left:"-=100px"},"slow",function(){n.isDone=!0}))},moveDown:function(){var n=this;n.isDone&&n.percent>1&&(n.isDone=!1,n.$legend.animate({top:"-=100px"},"slow",function(){n.isDone=!0}))},redraw:function(){var n=this;n.curCoords.length>0&&(n.clearHotpoint(),n.activateHotpoint(n.curCoords,n.curCallouts))},scalingDownCalc:function(n,t,i,r){var u,f,e,o;return t/n>=r/i?t>r?(f=r,u=n*r/t):(u=n,f=t):n>i?(u=i,f=t*i/n):(u=n,f=t),e=(r-f)/2,o=(i-u)/2,{width:u,height:f,top:e,left:o}},getAssistiveToolTemplate:function(){var i=this,r=i.opts.assistiveTool;return n(t).wrap("<div><\/div>").parent().find("div[data-template-id='"+r+"']").get(0).outerHTML},loadingShow:function(){var n=this,t='<span style="display:block;line-height:28px;font-family:微软雅黑,font-size:10pt;height:28px;">loading...<\/span>';n.legendLoadingImg&&(t="<img src='"+n.legendLoadingImg+"' />");n.$legendWrap.children(".blockUI").size()||n.$legendWrap.block({message:t,baseZ:900,css:{width:"15%",border:"none",background:"transparent"}})},loadingHide:function(){var n=this;n.$legendWrap.unblock()}}}(),r}if(typeof define=="function"&&define.amd&&define.amd.jQuery){var i=function(){var n,i=require.s.contexts._.config,t=i.paths.hotpoint;if(typeof t!="undefined")return n=t.split(/\/+/g),n.slice(0,n.length-2).join("/")+"/";alert("require config paths 'hotpoint' key not exist")}();define(["text!"+i+"template/assistive-template.htm","mousewheel","normalize","jsDraw2D","scrollIntoView",],t)}else t(jQuery)})(jQuery);
/*
//# sourceMappingURL=hotpoint.min.js.map
*/